<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="VOdSVFLZgu5oX1fWGwT5OkE9QF-b6k3XMEZIkFIuiTA" />

<title>Facebookのflowtypeについて - ◯ △ □</title>

<link rel="icon" href="https://blog.yudppp.com/img/favicon.png">
<link rel="shortcut icon" href="https://blog.yudppp.com/img/favicon.png">
<link rel="stylesheet" href="https://blog.yudppp.com/css/lib.min.css">
<link rel="stylesheet" href="https://blog.yudppp.com/css/app.min.css">
<link rel="alternate" href="https://blog.yudppp.com/index.xml" title="" type="application/rss+xml">

<meta property="og:type", content="article">
<meta property="og:url", content="https://blog.yudppp.com/posts/about_flowtype/">
<meta property="og:site_name", content="◯ △ □">
<meta property="og:title", content="Facebookのflowtypeについて">


  <meta name="description" content="はじめに 最近babelやらES6やらがかなり盛り上がってる中facebookのflow(flowtype)をちゃんと触ってみようと思います。 TypeScriptと比べると型推論が賢かったり、コンパイルが速いらしいです。
インストール Macだとbrewでさっとinstallできるようです。
$ brew update $ brew install flow  windows等ではzip等で落としてくるそうです。
こちらをみれば簡単にinstallできました。
flowを触ってみる HelloWorld fileのはじめに/* @flow */でflowを使うことを宣言します。
/* @flow */ function foo(x) { return x * 10; } foo(&#39;Hello, world!&#39;);  このように数値をいれて使いたい関数に間違って文字列をいててしまった場合に$ flow checkでチェックしてみます。すると
$ flow check /Users/.../examples/01_HelloWorld/hello.js:7:5,19: string This type is incompatible with /Users/.../examples/01_HelloWorld/hello.js:4:10,13: number  7行目(foo(&lsquo;Hello, world!&rsquo;);)で文字列代入してるけど4行目(return x * 10;)で計算してるから数字でないとだめだよと、ちゃんと怒られました。
またES6にも一部対応していて
/* @flow */ var foo = (x) =&gt; x*10 foo(&#39;Hello, world!&#39;);  このようなファイルもちゃんとみてくれました。">


  </head>
  <body class="hack">
    <header>
  <div class="container">
    
    <div class="nav">
      <div class="nav__left">
        <span class="nav__item">
          <a class="nocolor" href="https://blog.yudppp.com">
            <canvas class="mini-logo" width="150" height="50">
          </a>
        </span>
      </div>
    </div>
    <div class="title">
      <h1>Facebookのflowtypeについて</h1>
    </div>
    
  </div>
</header>

    <main>
      <div class="container">
        <date>2015.05.24</date>
        <div class="content">
          

<h2 id="はじめに">はじめに</h2>

<p>最近babelやらES6やらがかなり盛り上がってる中facebookの<a href="http://flowtype.org/">flow(flowtype)</a>をちゃんと触ってみようと思います。
TypeScriptと比べると型推論が賢かったり、コンパイルが速いらしいです。</p>

<h2 id="インストール">インストール</h2>

<p>Macだとbrewでさっとinstallできるようです。</p>

<pre><code>$ brew update
$ brew install flow
</code></pre>

<p>windows等ではzip等で落としてくるそうです。</p>

<p><a href="http://flowtype.org/docs/getting-started.html#_">こちら</a>をみれば簡単にinstallできました。</p>

<h2 id="flowを触ってみる">flowを触ってみる</h2>

<h4 id="helloworld">HelloWorld</h4>

<p>fileのはじめに<code>/* @flow */</code>でflowを使うことを宣言します。</p>

<pre><code>/* @flow */

function foo(x) {
  return x * 10;
}

foo('Hello, world!');
</code></pre>

<p>このように数値をいれて使いたい関数に間違って文字列をいててしまった場合に<code>$ flow check</code>でチェックしてみます。すると</p>

<pre><code>$ flow check

/Users/.../examples/01_HelloWorld/hello.js:7:5,19: string
This type is incompatible with
/Users/.../examples/01_HelloWorld/hello.js:4:10,13: number
</code></pre>

<p>7行目(foo(&lsquo;Hello, world!&rsquo;);)で文字列代入してるけど4行目(return x * 10;)で計算してるから数字でないとだめだよと、ちゃんと怒られました。</p>

<p>またES6にも一部対応していて</p>

<pre><code>/* @flow */

var foo = (x) =&gt; x*10

foo('Hello, world!');
</code></pre>

<p>このようなファイルもちゃんとみてくれました。</p>

<p>これらの<code>foo('Hello, world!');</code>を正しく計算できるよう<code>foo(10);</code>等に修正し再び<code>flow check</code>してみると</p>

<pre><code>$ flow check

Found 0 errors
</code></pre>

<p>とエラーがないことを教えてくれました。</p>

<h4 id="型付け">型付け</h4>

<p>先ほどは型推論していたので今回は自分で型をつけてみます。</p>

<pre><code>/* @flow */

// Changing the return type to number fixes the error
function foo(x: string, y: number): number {
  return x.length * y;
}

foo('Hello', 42);
</code></pre>

<p>このように引数の後に型を宣言することができる。</p>

<p>宣言できる型の種類は
jsの基本の型としては</p>

<ul>
<li>number</li>
<li>string</li>
<li>boolean</li>
<li>void</li>
</ul>

<p>の4つとコンストラクタ名と<code>mixed</code>と<code>any</code>になります。</p>

<p>mixedはすべての型の上位の型(supertype)でanyは動的な型でなにでも使えるものになっています。
ここの違いが自分の中で曖昧なので今後ちゃんと調べてみようと思います。</p>

<p>このあたりはdocsに書いてあります。</p>

<p><a href="http://flowtype.org/docs/base-types.html">http://flowtype.org/docs/base-types.html</a></p>

<h4 id="nullの扱い">nullの扱い</h4>

<p>flowtypeではnullをちゃんと処理しないといけないようです。</p>

<pre><code>/* @flow */

function length(x) {
  return x.length;
}

var total = length('Hello') + length(null);
</code></pre>

<p>このようなfileをチェックすると</p>

<pre><code>$ flow check

/Users/.../examples/03_Null/nulls.js:4:10,17: property length
Property cannot be accessed on possibly null value
  /Users/.../examples/03_Null/nulls.js:7:38,41: null
</code></pre>

<p>nullの値にはアクセスできないと教えてくれます。</p>

<pre><code>/* @flow */

function length(x) {
  if (x !== null) {
    return x.length;
  } else {
    return 0;
  }
}

var total = length('Hello') + length(null);
</code></pre>

<p>上記のようにちゃんとnullの場合の処理をしてあげることによってエラーがなくなります。</p>

<h4 id="arrayについて">Arrayについて</h4>

<p>Arrayの中身に対して型付けを行う場合、<code>Array&lt;number&gt;</code>と宣言します。</p>

<pre><code>/* @flow */

function total(numbers: Array&lt;number&gt;) {
  var result = 0;
  for (var i = 0; i &lt; numbers.length; i++) {
    result += numbers[i];
  }
  return result;
}

total([1, 2, 3, 'Hello']);
</code></pre>

<p>このようなfileをチェックするとちゃんと怒ってくれました。</p>

<h4 id="型が動的なコードについて">型が動的なコードについて</h4>

<p>極力避けるべきだとは思いますが時には型を動的にしたい場合がでてくると思います。</p>

<p>そんなときはこのように場合わけをすれば、flowtypeがちゃんとみてくれます。</p>

<pre><code>/* @flow */

function foo(x) {
  if (typeof x === 'string') {
    return x.length;
  } else {
    return x;
  }
}

var res = foo('Hello') + foo(42);
</code></pre>

<p><code>typeof</code>を読み取ってエラーをださずに動いてくれます。</p>

<h2 id="まとめ">まとめ</h2>

<p>flowtypeの言語仕様?をなんとなく勉強してみました。
少ししか触って見ていないのでイメージでしかないのですが、
altJSというよりも型をちゃんと見てくれるjsLintやjsHintなイメージになりました。</p>

<p>次回は新しいプロジェクトを作ってみたいと思います。</p>

<h2 id="参考文献">参考文献</h2>

<p><a href="http://flowtype.org/">http://flowtype.org/</a></p>

          <a href="https://twitter.com/share" class="twitter-share-button" data-via="yudppp">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-noballoon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
          <div class="comment">
    <div>
        <a id="js-open-comment" class="event">
            show comment <span class="disqus-comment-count" data-disqus-url="https://blog.yudppp.com/posts/about_flowtype/"></span>
        </a>
    </div>
    <div id="disqus_thread"></div>
</div>
<script type="text/javascript">
     
     
    var openDiqus = function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//yudppp.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    document.all("js-open-comment").style.display = "none";
    };
    document.getElementById("js-open-comment").addEventListener('click',openDiqus,false);
</script>
        </div>
      </div>
    </main>
    
<div class="container">
	<div class="prevnext">
		
		<a class="pull-left" href="https://blog.yudppp.com/posts/golang-jst-parse/">
			<div>&lt;&lt; 【golang】JSTの時間をうまくParseする</div>
		</a>
		
		
		<a class="pull-right" href="https://blog.yudppp.com/posts/npm-publish/">
			<div>npmで公開する &gt;&gt;</div>
		</a>
		
	</div>
</div>

    <div class="container">
  <a href="https://blog.yudppp.com/posts/whoami/">
    <div class="media profile">
      <div class="media-left">
        <img class="avatarholder" src="https://blog.yudppp.com/img/profile.svg" />
      </div>
      <div class="media-body">
        <div class="media-heading">@yudppp</div>
        <div class="media-content">Web engineer.</div>
      </div>
    </div>
  </a>
</div>

    <script src="https://blog.yudppp.com/js/lib.min.js"></script>
<script src="https://blog.yudppp.com/js/app.min.js"></script>
<script id="dsq-count-scr" src="//yudppp.disqus.com/count.js" async></script>
  </body>
</html>
